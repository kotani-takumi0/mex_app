# Implementation Plan

## Tasks

- [x] 1. プロジェクト基盤とインフラストラクチャのセットアップ
- [x] 1.1 開発環境とプロジェクト構造の初期化
  - Python 3.12 + FastAPIのバックエンドプロジェクトを作成し、レイヤードアーキテクチャに従ったディレクトリ構造を構築する
  - React 18 + TypeScriptのフロントエンドプロジェクトを作成し、型安全な開発環境を整備する
  - 依存関係管理（Poetry/pip、npm/yarn）とリンター・フォーマッター設定を行う
  - _Requirements: 1.1, 2.1, 3.1_

- [x] 1.2 (P) データベーススキーマとマイグレーションの実装
  - PostgreSQLのdecision_cases、failure_pattern_tags、case_failure_patterns、idea_memosテーブルを作成する
  - JSONB型を使用した柔軟なスキーマ設計と、title・purpose・target_marketへの全文検索インデックスを設定する
  - マイグレーションツール（Alembic等）を導入し、バージョン管理可能なスキーマ変更を実現する
  - _Requirements: 3.2_

- [x] 1.3 (P) Qdrantベクトルデータベースのセットアップ
  - Qdrantのローカル開発環境またはDocker構成を用意する
  - decision_casesコレクションを3072次元のCosine距離で作成し、case_id・outcome・failure_patternsのペイロードスキーマを定義する
  - HNSWインデックスの初期パラメータを設定する
  - _Requirements: 1.1, 2.2_

- [x] 2. ドメインレイヤーの実装
- [x] 2.1 埋め込み生成サービスの実装
  - OpenAI text-embedding-3-large APIを呼び出し、テキストから3072次元のベクトルを生成する機能を実装する
  - APIキー管理とレート制限対応を組み込む
  - 生成エラー時のリトライロジックとフォールバック処理を実装する
  - _Requirements: 1.1, 3.2_

- [x] 2.2 類似検索エンジンの実装
  - Qdrantへのベクトル類似検索機能を実装し、クエリテキストから類似ケースを取得できるようにする
  - PostgreSQLの全文検索（BM25相当）とベクトル検索を組み合わせたハイブリッド検索を実装する
  - ベクトルスコアとテキストスコアの重み付け調整とリランキング機能を追加する
  - _Requirements: 1.1, 2.2_

- [x] 2.3 (P) 意思決定ケースマネージャーの実装
  - 意思決定ケースの作成・取得・更新機能を実装し、PostgreSQLへのメタデータ保存とQdrantへのベクトル保存を連携させる
  - 類似ケース検索のファサードとして、SimilarityEngineを呼び出す統合インターフェースを提供する
  - 失敗パターンタグの追加・管理機能を実装する
  - _Requirements: 1.1, 2.2, 3.2_

- [x] 2.4 (P) 失敗パターン分析エンジンの実装
  - 過去の意思決定ケースから論点・懸念点を抽出し、カテゴリ別に要約する機能を実装する
  - プロジェクトフェーズに基づいて、過去にボトルネックとなった論点を特定するロジックを構築する
  - LLMを活用したパターン要約生成機能を追加する
  - _Requirements: 1.2, 2.1, 3.2_

- [x] 2.5 問い生成エンジンの実装
  - 類似ケースと失敗パターンに基づき、企画の質を向上させるための「問い」を生成するプロンプトを設計する
  - LLM（GPT-4/Claude）APIを呼び出し、ドメイン共通の視点と過去の失敗パターンから問いを生成する
  - 生成された問いをカテゴリ（財務、オペレーション、市場、技術、組織）に分類する
  - _Requirements: 1.3_

- [x] 3. アプリケーションレイヤーの実装
- [x] 3.1 企画ドラフトレビューサービスの実装
  - 企画ドラフト情報（目的・ターゲット・ビジネスモデル）を受け取り、類似ケース検索と問い生成をオーケストレーションする
  - 採用案と没案の両方を提示し、抽出された類似ケースに基づく論点・懸念点を要約して返却する
  - ユーザーの回答状況を追跡し、未検討項目を可視化するレビュー進捗管理機能を実装する
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [x] 3.2 (P) ゲートレビュー支援サービスの実装
  - 案件フェーズと仮説状況に基づき、会議のアジェンダ候補を自動生成する機能を実装する
  - 過去の類似案件で「なぜ採用/不採用になったか」の主要因を検索・表示できる機能を提供する
  - 論点候補リストを整理し、会議前に参照可能な形式で出力する
  - _Requirements: 2.1, 2.2_

- [x] 3.3 (P) ポストモーテムサービスの実装
  - プロジェクト撤退・中止・ペンディング時に、仮説の崩壊理由と組織内議論を入力するテンプレートを提供する
  - Go/NoGo判断と理由（1〜3文）の有無を検証し、ケースとアイデアメモを区別して保存する
  - 失敗パターンタグの候補をLLMで推定し、ユーザーに提示する機能を実装する
  - _Requirements: 3.1, 3.2, 3.3_

- [x] 4. APIレイヤーの実装
- [x] 4.1 企画ドラフトレビューAPIエンドポイントの実装
  - POST /api/draft-reviews エンドポイントで企画ドラフト情報を受け取り、類似ケース・問い・懸念点を返却する
  - PUT /api/draft-reviews/{id}/progress エンドポイントで回答進捗を更新し、未検討項目を返却する
  - 入力バリデーションとエラーハンドリング（400, 404, 422, 500）を実装する
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [x] 4.2 (P) ゲートレビューAPIエンドポイントの実装
  - POST /api/gate-reviews/agenda エンドポイントでアジェンダ候補を生成して返却する
  - GET /api/gate-reviews/decision-reasons エンドポイントで過去の採用/不採用理由を検索する
  - リクエスト/レスポンスのスキーマ定義とバリデーションを実装する
  - _Requirements: 2.1, 2.2_

- [x] 4.3 (P) ポストモーテムAPIエンドポイントの実装
  - GET /api/postmortems/template/{projectId} エンドポイントでポストモーテムテンプレートを取得する
  - POST /api/postmortems エンドポイントでポストモーテム情報を受け取り、ケースまたはメモとして保存する
  - Go/NoGo判断の有無に応じた保存先の分岐とレスポンス型の切り替えを実装する
  - _Requirements: 3.1, 3.2, 3.3_

- [x] 5. フロントエンドUIの実装
- [x] 5.1 企画ドラフトレビュー画面の実装
  - 企画ドラフト情報（目的・ターゲット・ビジネスモデル）の入力フォームを作成する
  - 類似ケース（採用案・没案）の一覧表示と詳細モーダルを実装する
  - 生成された問いの表示、回答入力欄、未検討項目のハイライト機能を実装する
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [x] 5.2 (P) ゲートレビュー支援画面の実装
  - プロジェクトフェーズと仮説状況の入力・選択UIを作成する
  - アジェンダ候補リストの表示と、各項目の優先度調整機能を実装する
  - 過去の採用/不採用理由の検索・表示機能を実装する
  - _Requirements: 2.1, 2.2_

- [x] 5.3 (P) ポストモーテム入力画面の実装
  - 撤退・中止・ペンディングの選択と、仮説崩壊・議論内容の入力フォームを作成する
  - Go/NoGo判断と理由の入力欄を設け、入力有無に応じた保存種別の表示を行う
  - 失敗パターンタグの候補表示と選択UIを実装する
  - _Requirements: 3.1, 3.2, 3.3_

- [x] 6. 統合とエンドツーエンド検証
- [x] 6.1 フロントエンド・バックエンド統合
  - フロントエンドからバックエンドAPIへの接続を確立し、全エンドポイントの動作を確認する
  - 認証・認可（JWT Bearer Token）の実装とテナント分離の検証を行う
  - エラーハンドリングの統合（ユーザーフレンドリーなエラーメッセージ表示）を実装する
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 3.1, 3.2, 3.3_

- [x] 6.2 サンプルデータ投入とコールドスタート対応
  - 初期データとして複数の意思決定ケース（採用案・没案）をシードデータとして投入する
  - 失敗パターンタグのマスターデータ（財務、オペレーション、市場、技術、組織）を登録する
  - データが少ない場合の検索結果表示とフォールバック動作を検証する
  - _Requirements: 1.1, 2.2, 3.2_

- [x] 6.3 パフォーマンス検証と最適化
  - 1000件のケースに対する類似検索のレスポンスタイム（< 2秒）を検証する
  - LLM API呼び出しのレート制限対応とセマンティックキャッシュの動作を確認する
  - 同時10ユーザーでのドラフトレビューリクエスト処理をテストする
  - _Requirements: 1.1, 1.3, 2.1_
