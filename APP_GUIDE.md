# MEX App 説明書

このドキュメントは、MEX App を使うための基本的な手順と、MCPトークンの使い方をまとめたものです。
開発環境のセットアップは `README.md` を参照してください。

## 1. アプリ概要
MEX App は「AI支援開発の過程」を記録・可視化するポートフォリオアプリです。
プロジェクト単位で開発ログを残し、公開ポートフォリオとして共有できます。

## 2. 主要画面
| 画面 | パス | できること |
| --- | --- | --- |
| ランディング | `/` | サービス概要を確認 |
| 認証 | `/auth` | ログイン/登録 |
| ダッシュボード | `/dashboard` | 進捗サマリ、最近のプロジェクト |
| 設定 | `/settings` | プロフィール編集、MCPトークン管理 |
| 新規プロジェクト | `/projects/new` | プロジェクト作成 |
| プロジェクト詳細 | `/projects/:id` | 開発ログの閲覧・手動追加 |
| 公開ポートフォリオ | `/p/:username` | 公開プロフィールとプロジェクト一覧 |

## 3. 基本の使い方
1. `/auth` でユーザー登録またはログインします。
2. `/projects/new` でプロジェクトを作成します。
3. `/projects/:id` で開発ログを手動追加します。
4. `/settings` でプロフィールを整え、公開URL（`/p/:username`）を設定します。
5. 公開ページを共有してポートフォリオとして活用します。

## 4. MCPトークンの使い方
### MCPトークンとは
MCPトークンは、MCPサーバーや外部ツールが MEX App のAPIを使うための長寿命トークンです。
通常のWebログイン用JWT（60分）とは別に、MCP向けに約30日有効のトークンを発行します。

### 発行手順
1. `/settings` の「MCPトークン」セクションでトークンを発行します。
2. 発行直後に表示されるトークンを必ずコピーして保存します。
   トークン本体は後から再表示できません。

### MCPサーバーでの利用方法
MCPサーバーは `~/.mex/config.json` の `api_key` にトークンを設定して使います。

`~/.mex/config.json` の例:
```json
{
  "api_url": "http://localhost:8000/api",
  "api_key": "<your_mcp_token>",
  "ai_tool": "claude_code"
}
```

MCPサーバーのセットアップ:
```bash
npx mex-setup
```

Claude Code の MCP 設定（`~/.claude/mcp_servers.json`）に登録:
```json
{
  "mex": {
    "command": "npx",
    "args": ["mex-mcp-server"]
  }
}
```

詳しい手順は `MCP_SERVER.md` を参照してください。

### 無効化・再発行
- `/settings` からトークンを無効化できます。
- 期限切れや漏洩が疑われる場合は無効化し、新しいトークンを発行してください。

### セキュリティ注意点
- MCPトークンは API キーと同じ扱いです。第三者に共有しないでください。
- 公開リポジトリやログに混入しないよう注意してください。

## 5. 推奨ワークフロー：仕様書駆動開発 + 自動記録

MEX App では、仕様書駆動開発（Spec-Driven Development）を簡易的に取り入れた開発フローを推奨しています。
機能単位で仕様を定義し、タスクに分割した上で、タスクごとに AI に実装を依頼します。
**仕様策定フェーズ（要件定義・設計・タスク分割）も重要な開発活動であるため、各フェーズの完了後に `/document` で記録します。**

### 全体の流れ

```
要件定義 → 記録 → 設計 → 記録 → タスク分割 → 記録 → タスク実装 → 記録 → ... → 完了
```

### Step 1: 仕様を策定し、フェーズごとに記録する

Claude Code 上で Kiro コマンドを使い、要件 → 設計 → タスクの順に仕様を固めます。
**各フェーズの完了後に `/document` で記録してください。**

```bash
# 仕様の初期化
/kiro:spec-init "ユーザー認証機能"

# 要件定義
/kiro:spec-requirements user-auth
/document 認証機能の要件定義

# 技術設計
/kiro:spec-design user-auth
/document 認証機能の技術設計

# タスク分割
/kiro:spec-tasks user-auth
/document 認証機能のタスク分割
```

各フェーズの出力はレビューしてから次に進めてください。
進捗は `/kiro:spec-status user-auth` でいつでも確認できます。

### Step 2: タスクごとに AI に実装を依頼する

タスク一覧が生成されたら、1タスクずつ AI に実装を依頼します。

```bash
/kiro:spec-impl user-auth 1                # タスク1を実装
```

または自然言語で直接依頼しても構いません。

```
「タスク1のログインフォームを実装して」
```

### Step 3: `/document` で開発ログを記録する

実装が完了したら `/document` で記録します。

```bash
/document                                  # 直前の実装から自動推定
/document ログインフォームの実装             # 題名を明示的に指定
```

### Step 4: 繰り返す

次のタスクに進み、Step 2 → Step 3 を繰り返します。

```
タスク1 実装 → /document → タスク2 実装 → /document → ... → 完了
```

### 記録のタイミングの目安

| タイミング | `/document` |
| --- | --- |
| 要件定義の完了後 | 記録する |
| 技術設計の完了後 | 記録する |
| タスク分割の完了後 | 記録する |
| 機能の実装タスク完了後 | 記録する |
| バグ修正・デバッグ後 | 学びがあれば記録する |
| 小さなtypo修正・フォーマット変更 | 不要 |

すべてのタスクが完了した後、MEX App 上で各エントリの「学んだこと」欄に自分の言葉で振り返りを書くと、ポートフォリオとしてより充実したものになります。

## 6. `/document` コマンドの詳細

MCPサーバーと Notion 連携の設定が完了していれば、Claude Code 上で `/document` コマンドを使って開発ログを自動記録できます。

### 基本フロー
1. Claude Code に実装を依頼する（例：「認証機能を実装して」）
2. 実装が完了したら `/document` と入力する
3. Notion に技術ドキュメントが作成され、MEX App にエントリが記録される

### コマンド例
```bash
/document                        # 直前の git diff から内容を自動推定
/document React Routerの導入      # 題名を明示的に指定
/document バグ修正: APIレスポンス  # デバッグ系の記録
```

### 自動で行われること
- **git diff から実装内容を推定**（題名を省略した場合）
- **Notion に技術ドキュメントページを作成**（概要・技術ポイント・使用技術など）
- **MEX App にエントリを記録**（Notion ページの URL を `source_url` として保存）

### 補足
- 毎回の実装後に打つ必要はありません。ドキュメントとして残す価値がある実装の後に使ってください。
- MEX App の「学んだこと」欄は空欄のまま保存されます。後から自分の言葉で振り返りを書くための場所です。
- Notion 連携には Notion MCP サーバーの設定が別途必要です。

## 7. 補足
- MCPを使わない場合でも、手動で開発ログを追加できます。
- 開発環境のセットアップや起動手順は `README.md` を参照してください。
